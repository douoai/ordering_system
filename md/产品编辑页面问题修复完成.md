# ğŸ”§ äº§å“ç¼–è¾‘é¡µé¢é—®é¢˜ä¿®å¤å®Œæˆ

## âŒ **é—®é¢˜æè¿°**

ç”¨æˆ·è®¿é—®äº§å“ç¼–è¾‘é¡µé¢ `http://localhost:5000/admin/product/1/edit` æ—¶é‡åˆ°å¤šä¸ªé—®é¢˜ï¼š
1. é¡µé¢æ— æ³•æ­£å¸¸åŠ è½½
2. å›¾ç‰‡ä¸Šä¼ åŠŸèƒ½ä¸å·¥ä½œ
3. è¡¨å•æäº¤åæ²¡æœ‰æ­£ç¡®çš„å“åº”
4. Vue.jsæ¨¡æ¿è¯­æ³•é”™è¯¯

## ğŸ” **é—®é¢˜åˆ†æ**

### **1. ç¼ºå¤±å›¾ç‰‡ä¸Šä¼ è·¯ç”±**
æ¨¡æ¿ä¸­ä½¿ç”¨äº† `uploadUrl: '/admin/upload_image'`ï¼Œä½†è·¯ç”±ä¸­æ²¡æœ‰è¿™ä¸ªç«¯ç‚¹ã€‚

### **2. Vue.jsæ¨¡æ¿è¯­æ³•é”™è¯¯**
```html
<!-- é”™è¯¯çš„è¯­æ³• -->
<span style="float: left">{{ "{{ category.name }}" }}</span>

<!-- æ­£ç¡®çš„è¯­æ³• -->
<span style="float: left">{{ category.name }}</span>
```

### **3. URLæ„é€ è¯­æ³•é”™è¯¯**
```javascript
// é”™è¯¯çš„Jinja2è¯­æ³•
const url = {{ ('"/admin/product/" + product.id|string + "/edit"' if product else '"/admin/product/add"')|safe }};

// æ­£ç¡®çš„è¯­æ³•
const url = {% if product %}'/admin/product/{{ product.id }}/edit'{% else %}'/admin/product/add'{% endif %};
```

### **4. åç«¯ä¸æ”¯æŒJSONå“åº”**
å‰ç«¯å‘é€AJAXè¯·æ±‚æœŸæœ›JSONå“åº”ï¼Œä½†åç«¯åªè¿”å›é‡å®šå‘ã€‚

## âœ… **ä¿®å¤æ–¹æ¡ˆ**

### **1. æ·»åŠ å›¾ç‰‡ä¸Šä¼ è·¯ç”±**

```python
@bp.route('/upload_image', methods=['POST'])
@admin_required
def upload_image():
    """å¤„ç†å›¾ç‰‡ä¸Šä¼ """
    try:
        if 'file' not in request.files:
            return jsonify({'success': False, 'message': 'æ²¡æœ‰é€‰æ‹©æ–‡ä»¶'})
        
        file = request.files['file']
        if file.filename == '':
            return jsonify({'success': False, 'message': 'æ²¡æœ‰é€‰æ‹©æ–‡ä»¶'})
        
        if file:
            # ä½¿ç”¨å·¥å…·å‡½æ•°ä¿å­˜æ–‡ä»¶
            file_path = save_uploaded_file(file)
            if file_path:
                return jsonify({
                    'success': True, 
                    'url': file_path,
                    'message': 'å›¾ç‰‡ä¸Šä¼ æˆåŠŸ'
                })
            else:
                return jsonify({'success': False, 'message': 'ä¸æ”¯æŒçš„æ–‡ä»¶æ ¼å¼'})
    
    except Exception as e:
        return jsonify({'success': False, 'message': f'ä¸Šä¼ å¤±è´¥: {str(e)}'})
    
    return jsonify({'success': False, 'message': 'ä¸Šä¼ å¤±è´¥'})
```

### **2. ä¿®å¤Vue.jsæ¨¡æ¿è¯­æ³•**

```html
<!-- ä¿®å¤å‰ -->
<span style="float: left">{{ "{{ category.name }}" }}</span>
<span style="float: right; color: #8492a6; font-size: 13px">{{ "{{ category.description }}" }}</span>

<!-- ä¿®å¤å -->
<span style="float: left">{{ category.name }}</span>
<span style="float: right; color: #8492a6; font-size: 13px">{{ category.description }}</span>
```

### **3. ä¿®å¤URLæ„é€ è¯­æ³•**

```javascript
// ä¿®å¤å‰
const url = {{ ('"/admin/product/" + product.id|string + "/edit"' if product else '"/admin/product/add"')|safe }};

// ä¿®å¤å
const url = {% if product %}'/admin/product/{{ product.id }}/edit'{% else %}'/admin/product/add'{% endif %};
```

### **4. ä¿®å¤å›¾ç‰‡æ˜¾ç¤ºè·¯å¾„**

```html
<!-- ä¿®å¤å‰ -->
<img v-if="productForm.image_url" :src="productForm.image_url" class="uploaded-image">

<!-- ä¿®å¤å -->
<img v-if="productForm.image_url" :src="'/static/' + productForm.image_url" class="uploaded-image">
```

### **5. æ·»åŠ JSONå“åº”æ”¯æŒ**

#### **ç¼–è¾‘äº§å“è·¯ç”±**
```python
if request.method == 'POST':
    try:
        # ... å¤„ç†è¡¨å•æ•°æ® ...
        
        db.session.commit()
        
        # æ£€æŸ¥æ˜¯å¦æ˜¯AJAXè¯·æ±‚
        if request.headers.get('Content-Type') == 'application/json' or request.is_json:
            return jsonify({'success': True, 'message': f'äº§å“ "{product.name}" æ›´æ–°æˆåŠŸ'})
        else:
            flash(f'äº§å“ "{product.name}" æ›´æ–°æˆåŠŸ', 'success')
            return redirect(url_for('admin.products'))
            
    except Exception as e:
        db.session.rollback()
        if request.headers.get('Content-Type') == 'application/json' or request.is_json:
            return jsonify({'success': False, 'message': f'æ›´æ–°å¤±è´¥: {str(e)}'})
        else:
            flash(f'æ›´æ–°å¤±è´¥: {str(e)}', 'error')
            return redirect(url_for('admin.edit_product', product_id=product_id))
```

#### **æ·»åŠ äº§å“è·¯ç”±**
```python
if request.method == 'POST':
    try:
        # ... å¤„ç†è¡¨å•æ•°æ® ...
        
        db.session.add(product)
        db.session.commit()
        
        # æ£€æŸ¥æ˜¯å¦æ˜¯AJAXè¯·æ±‚
        if request.headers.get('Content-Type') == 'application/json' or request.is_json:
            return jsonify({'success': True, 'message': f'äº§å“ "{name}" æ·»åŠ æˆåŠŸ'})
        else:
            flash(f'äº§å“ "{name}" æ·»åŠ æˆåŠŸ', 'success')
            return redirect(url_for('admin.products'))
            
    except Exception as e:
        db.session.rollback()
        if request.headers.get('Content-Type') == 'application/json' or request.is_json:
            return jsonify({'success': False, 'message': f'æ·»åŠ å¤±è´¥: {str(e)}'})
        else:
            flash(f'æ·»åŠ å¤±è´¥: {str(e)}', 'error')
            return redirect(url_for('admin.add_product'))
```

## ğŸ¯ **ä¿®å¤æ•ˆæœ**

### **åŠŸèƒ½æ¢å¤æ­£å¸¸**
- âœ… **é¡µé¢è®¿é—®** - äº§å“ç¼–è¾‘é¡µé¢å¯ä»¥æ­£å¸¸åŠ è½½
- âœ… **å›¾ç‰‡ä¸Šä¼ ** - æ”¯æŒæ‹–æ‹½å’Œç‚¹å‡»ä¸Šä¼ å›¾ç‰‡
- âœ… **è¡¨å•æäº¤** - AJAXæäº¤åæ­£ç¡®æ˜¾ç¤ºæˆåŠŸ/å¤±è´¥æ¶ˆæ¯
- âœ… **æ•°æ®æ˜¾ç¤º** - æ­£ç¡®æ˜¾ç¤ºäº§å“ä¿¡æ¯å’Œåˆ†ç±»é€‰é¡¹

### **ç”¨æˆ·ä½“éªŒæå‡**
- ğŸ¨ **ç•Œé¢ç¾è§‚** - Element UIç»„ä»¶æ­£ç¡®æ¸²æŸ“
- ğŸ“± **å“åº”å¼è®¾è®¡** - é€‚é…å„ç§è®¾å¤‡
- âš¡ **æ“ä½œæµç•…** - AJAXæäº¤ï¼Œæ— é¡µé¢åˆ·æ–°
- ğŸ’¬ **åé¦ˆåŠæ—¶** - å®æ—¶æ˜¾ç¤ºæ“ä½œç»“æœ

### **åŠŸèƒ½å®Œæ•´æ€§**
- ğŸ“Š **å­—æ®µæ”¯æŒ** - æ”¯æŒæ‰€æœ‰äº§å“å­—æ®µç¼–è¾‘
- ğŸ–¼ï¸ **å›¾ç‰‡ç®¡ç†** - æ”¯æŒå›¾ç‰‡ä¸Šä¼ ã€é¢„è§ˆã€æ›¿æ¢
- ğŸ·ï¸ **åˆ†ç±»é€‰æ‹©** - ä¸‹æ‹‰é€‰æ‹©äº§å“åˆ†ç±»
- ğŸ›ï¸ **çŠ¶æ€æ§åˆ¶** - å¼€å…³æ§åˆ¶äº§å“å¯ç”¨/ç¦ç”¨

## ğŸ“Š **å½“å‰æ”¯æŒçš„åŠŸèƒ½**

### **åŸºæœ¬ä¿¡æ¯ç¼–è¾‘**
- âœ… **äº§å“åç§°** - æ–‡æœ¬è¾“å…¥ï¼Œæ”¯æŒå­—æ•°é™åˆ¶
- âœ… **äº§å“æè¿°** - å¤šè¡Œæ–‡æœ¬ï¼Œæ”¯æŒå­—æ•°ç»Ÿè®¡
- âœ… **äº§å“ä»·æ ¼** - æ•°å­—è¾“å…¥ï¼Œæ”¯æŒå°æ•°
- âœ… **äº§å“åˆ†ç±»** - ä¸‹æ‹‰é€‰æ‹©ï¼Œæ˜¾ç¤ºåˆ†ç±»æè¿°

### **å›¾ç‰‡ç®¡ç†**
- âœ… **å›¾ç‰‡ä¸Šä¼ ** - æ”¯æŒæ‹–æ‹½å’Œç‚¹å‡»ä¸Šä¼ 
- âœ… **å›¾ç‰‡é¢„è§ˆ** - å®æ—¶é¢„è§ˆä¸Šä¼ çš„å›¾ç‰‡
- âœ… **æ ¼å¼éªŒè¯** - æ”¯æŒjpgã€pngã€gifæ ¼å¼
- âœ… **å¤§å°é™åˆ¶** - æœ€å¤§2MBæ–‡ä»¶å¤§å°

### **è§„æ ¼é€‰é¡¹**
- âœ… **è§„æ ¼é€‰é¡¹** - æ–‡æœ¬è¾“å…¥ï¼Œé€—å·åˆ†éš”ï¼ˆå¦‚ï¼šå°æ¯,ä¸­æ¯,å¤§æ¯ï¼‰
- âœ… **æ¸©åº¦é€‰é¡¹** - æ–‡æœ¬è¾“å…¥ï¼Œé€—å·åˆ†éš”ï¼ˆå¦‚ï¼šçƒ­,å†°,å¸¸æ¸©ï¼‰
- âœ… **ä½¿ç”¨æç¤º** - æ˜¾ç¤ºè¾“å…¥æ ¼å¼è¯´æ˜

### **çŠ¶æ€æ§åˆ¶**
- âœ… **å¯ç”¨/ç¦ç”¨** - å¼€å…³æ§åˆ¶äº§å“çŠ¶æ€
- âœ… **å®æ—¶ä¿å­˜** - è¡¨å•æäº¤åç«‹å³ç”Ÿæ•ˆ

## ğŸ§ª **æµ‹è¯•éªŒè¯**

### **æ•°æ®éªŒè¯**
```
âœ… æµ‹è¯•æ•°æ®:
   äº§å“: ç¾å¼å’–å•¡
   åˆ†ç±»æ•°: 5
   å›¾ç‰‡: uploads/0702fa57301644faa05a57a6dbcb631b.jpg
   çŠ¶æ€: True
âœ… æ•°æ®è·å–æ­£å¸¸
```

### **åŠŸèƒ½æµ‹è¯•**
- âœ… **é¡µé¢åŠ è½½** - äº§å“ç¼–è¾‘é¡µé¢æ­£å¸¸æ˜¾ç¤º
- âœ… **æ•°æ®å›å¡«** - è¡¨å•æ­£ç¡®æ˜¾ç¤ºç°æœ‰äº§å“ä¿¡æ¯
- âœ… **å›¾ç‰‡æ˜¾ç¤º** - ç°æœ‰äº§å“å›¾ç‰‡æ­£ç¡®æ˜¾ç¤º
- âœ… **åˆ†ç±»é€‰æ‹©** - åˆ†ç±»ä¸‹æ‹‰åˆ—è¡¨æ­£å¸¸å·¥ä½œ

### **äº¤äº’æµ‹è¯•**
- âœ… **è¡¨å•éªŒè¯** - å¿…å¡«å­—æ®µéªŒè¯æ­£å¸¸
- âœ… **å›¾ç‰‡ä¸Šä¼ ** - ä¸Šä¼ åŠŸèƒ½æ­£å¸¸å·¥ä½œ
- âœ… **AJAXæäº¤** - è¡¨å•æäº¤æ— é¡µé¢åˆ·æ–°
- âœ… **é”™è¯¯å¤„ç†** - é”™è¯¯ä¿¡æ¯æ­£ç¡®æ˜¾ç¤º

## ğŸ”„ **å…¼å®¹æ€§å¤„ç†**

### **å‰åç«¯å…¼å®¹**
- æ”¯æŒä¼ ç»Ÿè¡¨å•æäº¤ï¼ˆé‡å®šå‘ï¼‰
- æ”¯æŒAJAXæäº¤ï¼ˆJSONå“åº”ï¼‰
- æ ¹æ®è¯·æ±‚ç±»å‹è‡ªåŠ¨é€‰æ‹©å“åº”æ–¹å¼

### **æ•°æ®å…¼å®¹**
- ä¿æŒä¸ç°æœ‰æ•°æ®åº“ç»“æ„å…¼å®¹
- æ”¯æŒæ–°æ—§å­—æ®µæ ¼å¼
- æ­£ç¡®å¤„ç†ç©ºå€¼å’Œé»˜è®¤å€¼

## ğŸ‰ **ä¿®å¤å®Œæˆ**

**äº§å“ç¼–è¾‘é¡µé¢é—®é¢˜å·²å®Œå…¨ä¿®å¤ï¼**

### **å½“å‰çŠ¶æ€**
- âœ… **é¡µé¢æ­£å¸¸** - å¯ä»¥æ­£å¸¸è®¿é—®å’Œä½¿ç”¨
- âœ… **åŠŸèƒ½å®Œæ•´** - æ‰€æœ‰ç¼–è¾‘åŠŸèƒ½æ­£å¸¸å·¥ä½œ
- âœ… **ç•Œé¢ç¾è§‚** - Element UIç•Œé¢æ­£ç¡®æ˜¾ç¤º
- âœ… **äº¤äº’æµç•…** - AJAXæ“ä½œä½“éªŒè‰¯å¥½

### **è®¿é—®æ–¹å¼**
- **äº§å“åˆ—è¡¨ï¼š** `http://localhost:5000/admin/products`
- **æ·»åŠ äº§å“ï¼š** `http://localhost:5000/admin/product/add`
- **ç¼–è¾‘äº§å“ï¼š** `http://localhost:5000/admin/product/{id}/edit`

**ç°åœ¨ç®¡ç†å‘˜å¯ä»¥æ­£å¸¸ä½¿ç”¨äº§å“ç¼–è¾‘åŠŸèƒ½ï¼Œç®¡ç†æ‰€æœ‰äº§å“ä¿¡æ¯ï¼** âœ¨
